<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Zoom Collaboration</title>

<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">

<script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/simple-peer@9/simplepeer.min.js"></script>

<style>
*{margin:0;padding:0;box-sizing:border-box;font-family:'Poppins',sans-serif;}
body{background:#121212;color:white;display:flex;flex-direction:column;align-items:center;min-height:100vh;}
h2{margin:10px;font-size:1.8rem;color:#fff;text-shadow:0 0 8px #6A11CB;text-align:center;}
#timer{margin-bottom:8px;font-size:1rem;}
#videos{display:flex;flex-wrap:wrap;gap:10px;width:95%;max-width:600px;justify-content:center;}
video{width:200px;height:150px;border-radius:15px;background:black;box-shadow:0 0 20px #6A11CB;}
.panel{width:90%;max-width:600px;background:rgba(255,255,255,0.05);backdrop-filter:blur(10px);margin-top:10px;padding:12px;border-radius:15px;box-shadow:0 0 15px rgba(0,0,0,0.5);}
#chatBox{height:100px;overflow-y:auto;background:rgba(0,0,0,0.2);padding:8px;border-radius:10px;}
#chatInput{width:100%;padding:10px;margin-top:6px;border-radius:10px;border:none;background:rgba(0,0,0,0.3);color:white;}
#participants{list-style:none;margin-top:6px;padding-left:0;}
footer{position:fixed;bottom:0;width:100%;background:rgba(255,255,255,0.05);backdrop-filter:blur(10px);padding:8px;display:flex;justify-content:center;border-top:1px solid rgba(255,255,255,0.2);}
.controls button{background:linear-gradient(135deg,#6A11CB,#2575FC);border:none;width:45px;height:45px;border-radius:50%;margin:0 5px;color:white;font-size:18px;cursor:pointer;transition:0.3s;}
.controls button:hover{transform:scale(1.1);}
@media(max-width:500px){
  h2{font-size:1.4rem;}
  #timer{font-size:0.9rem;}
  video{height:auto;}
  .panel{padding:10px;}
  #chatBox{height:80px;}
  #chatInput{padding:8px;}
  .controls button{width:40px;height:40px;font-size:16px;margin:3px;}
}
</style>
</head>

<body>

<h2 id="titleName">ZOOM</h2>
<div id="timer">00:00:00</div>

<div id="videos"></div>

<div class="panel">
<h3>Chat</h3>
<div id="chatBox"></div>
<input id="chatInput" placeholder="Type message..." />
</div>

<div class="panel">
<h3>Participants</h3>
<ul id="participants"></ul>
</div>

<footer>
<div class="controls">
<button onclick="toggleCamera()">üì∑</button>
<button onclick="toggleMic()">üé§</button>
<button onclick="shareScreen()">üñ•Ô∏è</button>
<button onclick="leave()">‚ùå</button>
</div>
</footer>

<script>
const socket = io(); // connects to Render server
const peers = {};
let localStream;
let camOn = true;
let micOn = true;

const videos = document.getElementById("videos");
const chatBox = document.getElementById("chatBox");
const chatInput = document.getElementById("chatInput");
const participantsList = document.getElementById("participants");

const user = localStorage.getItem("username") || prompt("Enter your name") || "Guest";
localStorage.setItem("username", user);
document.getElementById("titleName").innerText = "Welcome, " + user;

socket.emit("join", user);

// Timer
let seconds = 0;
setInterval(() => {
  seconds++;
  const h = String(Math.floor(seconds / 3600)).padStart(2,"0");
  const m = String(Math.floor((seconds % 3600) / 60)).padStart(2,"0");
  const s = String(seconds % 60).padStart(2,"0");
  document.getElementById("timer").innerText = `${h}:${m}:${s}`;
}, 1000);

// Camera
navigator.mediaDevices.getUserMedia({video:true,audio:true})
.then(stream=>{
  localStream = stream;
  addVideo(stream);
});

// Chat
chatInput.addEventListener("keydown", e => {
  if(e.key === "Enter" && chatInput.value.trim()){
    socket.emit("message", chatInput.value);
    chatInput.value = "";
  }
});

socket.on("message", msg=>{
  chatBox.innerHTML += `<div><b>${msg.from}:</b> ${msg.text}</div>`;
  chatBox.scrollTop = chatBox.scrollHeight;
});

// Participants & WebRTC
socket.on("participants", users=>{
  participantsList.innerHTML = "";
  for(const id in users){
    const li = document.createElement("li");
    li.textContent = users[id] + (id === socket.id ? " (You)" : "");
    participantsList.appendChild(li);

    if(id !== socket.id && !peers[id]){
      const peer = new SimplePeer({initiator:true,trickle:false,stream:localStream});
      peer.on("signal", s => socket.emit("signal",{to:id,signal:s}));
      peer.on("stream", s => addVideo(s));
      peers[id] = peer;
    }
  }
});

socket.on("signal", data=>{
  if(!peers[data.from]){
    const peer = new SimplePeer({initiator:false,trickle:false,stream:localStream});
    peer.on("signal", s => socket.emit("signal",{to:data.from,signal:s}));
    peer.on("stream", s => addVideo(s));
    peer.signal(data.signal);
    peers[data.from] = peer;
  } else {
    peers[data.from].signal(data.signal);
  }
});

// Helpers
function addVideo(stream){
  const v = document.createElement("video");
  v.srcObject = stream;
  v.autoplay = true;
  v.playsInline = true;
  videos.appendChild(v);
}

function toggleCamera(){
  camOn = !camOn;
  localStream.getVideoTracks()[0].enabled = camOn;
}

function toggleMic(){
  micOn = !micOn;
  localStream.getAudioTracks()[0].enabled = micOn;
}

async function shareScreen(){
  const screen = await navigator.mediaDevices.getDisplayMedia({video:true});
  for(const id in peers){
    peers[id].replaceTrack(
      localStream.getVideoTracks()[0],
      screen.getVideoTracks()[0],
      localStream
    );
  }
}

function leave(){
  window.location.reload();
}
</script>
  
  <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
  
</body>
</html>

